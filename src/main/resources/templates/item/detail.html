<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>바꾸조</title>
    <link rel="icon" href="../../static/img/favicon.png" type="image/png">
    <!-- Bootstrap core CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootswatch Litera theme -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3/litera/bootstrap.min.css?ver=1.0" rel="stylesheet">
    <!-- Bootstrap Icons CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="../../static/css/reset.css?ver=1.0" rel="stylesheet">
    <link href="../../static/css/custom.css" rel="stylesheet">
</head>
<body>

<th:block th:replace="~{/fragment/header :: headerFragment}"></th:block>

<div class="margin-top container">
    <div class="d-flex w-90 p-2">
        <div id="carouselExampleIndicators" class="carousel slide w-50 mr-5" data-ride="carousel" data-interval="false">
            <ol class="carousel-indicators">
                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                <li th:each="itemImage, iterStat : ${itemDetail.itemImages}" th:if="${iterStat.index > 0}" th:data-target="${#carouselExampleIndicators}" th:data-slide-to="${iterStat.index}"></li>
            </ol>
            <div class="carousel-inner">
                <div th:each="itemImage, iterStat : ${itemDetail.itemImages}" th:classappend="${iterStat.index == 0} ? 'carousel-item active' : 'carousel-item'">
                    <img th:src="@{'/images/' + ${itemImage}}" class="d-block detail-image mx-auto" alt="상품이미지">
                </div>
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>


        <div class="w-100 h-100 mt-3">
            <div class="mb-3">
                <h1 th:text="${itemDetail.title}">제목</h1>
                <hr />
            </div>
            <div class="d-flex">
                <label class="pr-3">작성자</label>
                <p th:text="${itemDetail.nickname}">작성자</p>
            </div>
            <div class="d-flex">
                <label class="pr-3">작성일</label>
                <p th:text="${itemDetail.formattedUpdateDate}">업데이트 날짜</p>
            </div>
            <div class="d-flex">
                <label class="pr-3">사용감</label>
                <p th:text="${itemDetail.itemCondition.kor}">사용감</p>
            </div>
            <div class="d-flex">
                <label class="pr-3">상태</label>
                <p th:text="${itemDetail.itemStatus.kor}">상태</p>
            </div>
            <div class="d-flex">
                <label class="pr-3">카테고리</label>
                <p th:text="${itemDetail.itemCategoryName}">카테고리 이름</p>
            </div>

            <div class="d-flex w-100 justify-between mt-5">
                <!-- 로그인된 사용자에게만 보이는 좋아요 버튼 (anonymousUser는 인증되지 않은 사용자) -->
                <div class="d-flex mr-2" th:if="${#authentication?.principal != 'anonymousUser'}">
                    <button id="favorite-btn" class="d-flex btn btn-outline-danger align-items-center fs-5">
                        <i id="favorite-icon" class="bi bi-heart mr-2 fs-5" th:classappend="${isFavorite} ? 'bi-heart-fill' : 'bi-heart'"></i>
                        <span>3</span>
                    </button>
                </div>

                <!-- 비로그인 사용자에게만 보이는 로그인 유도 버튼 -->
                <div class="d-flex mr-2" th:if="${#authentication?.principal == 'anonymousUser'}">
                    <button class="d-flex btn btn-outline-danger align-items-center fs-5" onclick="alert('로그인이 필요합니다.'); window.location.href='/member/login';">
                        <i class="bi bi-heart mr-2 fs-5"></i>
                        <span>3</span>
                    </button>
                </div>
                <button class="btn btn-success fs-5">교환신청</button>
            </div>
        </div>
    </div>

    <hr class="w-80"/>


    <div class="w-80">
        <h4 class="pr-3 mb-4">물품 내용</h4>
        <p th:text="${itemDetail.description}">내용</p>
    </div>

</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function() {
        $('#favorite-btn').click(function() {
            let itemId = [[${itemDetail.id}]];
            $.ajax({
                url: '/favorite/toggle/' + itemId,
                method: 'POST',
                contentType: 'application/json',
                success: function(response) {
                    let icon = $('#favorite-icon');
                    if (response) {
                        icon.removeClass('bi-heart').addClass('bi-heart-fill');
                    } else {
                        icon.removeClass('bi-heart-fill').addClass('bi-heart');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('좋아요 토글 실패:', error);
                }
            });
        });
    });
</script>
</body>
</html>
