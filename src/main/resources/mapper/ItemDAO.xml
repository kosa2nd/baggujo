<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.baggujo.dao.ItemDAO">
    <!-- 아이템 생성 -->
    <insert id="insertItem" parameterType="com.baggujo.dto.ItemInsertDTO">
        <selectKey order="BEFORE" keyProperty="id" resultType="long">
            select item_pk_seq.nextval from dual
        </selectKey>
        <![CDATA[
            insert into item (id, title, description, status,
            condition, item_category_id, member_id)
            values(#{id}, #{title}, #{description}, #{itemStatus},
            #{itemCondition}, #{itemCategoryId}, #{memberId})
        ]]>
    </insert>

    <!-- 아이템 상세 조회 -->
    <select id="getItemDetailById" parameterType="long" resultType="com.baggujo.dto.ItemDetailDTO">
        SELECT i.id, i.title, i.description, i.enable, i.status AS itemStatus, i.condition AS itemCondition,
               i.item_category_id AS itemCategoryId, c.category AS itemCategoryName
        FROM BAGGUJO.ITEM i
                 JOIN ITEM_CATEGORY c ON i.item_category_id = c.id
        WHERE i.id = #{id}
    </select>

    <!-- 아이템 카테고리 조회 -->
    <select id="getCategories" resultType="com.baggujo.dto.CategoryDTO">
        SELECT id as itemCategoryId, category as itemCategoryName FROM ITEM_CATEGORY
    </select>
    <!-- 상품리스트 조회 -->
    <select id="getItemPreviews" resultType="com.baggujo.dto.itemPreviewDTO">
        select * from (
        select i.id, i.title, i.description, i.enable, i.status as itemStatus, i.condition as itemCondition, ii.s_name
        from item i, item_image ii, member m
        join item_image ii on i.id = ii.item_id
        join member m on i.member_id = m.id
        where i.id != #{id}
        order by i.id desc
        )
        offset 0 rows fetch first 12 rows only
    </select>

</mapper>